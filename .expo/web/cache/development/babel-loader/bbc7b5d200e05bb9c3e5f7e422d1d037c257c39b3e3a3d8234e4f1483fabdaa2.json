{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { React, useState, useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from \"../firebase/firebase\";\nimport { useSelector } from \"react-redux\";\nimport * as ImagePicker from 'expo-image-picker';\nimport { FontAwesome } from '@expo/vector-icons';\nimport { getStorage, ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar CreateComment = function CreateComment(_ref) {\n  var postId = _ref.postId;\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    reply = _useState2[0],\n    setReply = _useState2[1];\n  var userId = useSelector(function (state) {\n    return state.userProfile.userId;\n  });\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    image = _useState4[0],\n    setImage = _useState4[1];\n  var handleCommentSubmit = function handleCommentSubmit() {\n    if (reply.trim() !== '') {\n      var addComment = function () {\n        var _ref2 = _asyncToGenerator(function* (postId, comment) {\n          try {\n            var commentRef = collection(db, 'Posts', postId, 'comments');\n            var handleImageUpload = function () {\n              var _ref3 = _asyncToGenerator(function* (image) {\n                setLoading(true);\n                var storage = getStorage(app);\n                var storageRef = ref(storage, \"images/\" + Date.now() + \"_\" + image);\n                var response = yield fetch(image);\n                var blob = yield response.blob();\n                var uploadTask = uploadBytes(storageRef, blob);\n                yield uploadTask;\n                var downloadURL = yield getDownloadURL(storageRef);\n                return downloadURL;\n              });\n              return function handleImageUpload(_x3) {\n                return _ref3.apply(this, arguments);\n              };\n            }();\n            var downloadURL = '';\n            if (image) {\n              downloadURL = yield handleImageUpload(image);\n            }\n            yield addDoc(commentRef, {\n              userId: userId,\n              reply: reply,\n              downloadURL: downloadURL,\n              timestamp: serverTimestamp()\n            });\n          } catch (error) {\n            alert('Failed to add comment');\n            console.error('Error adding comment: ', error);\n          }\n        });\n        return function addComment(_x, _x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      addComment(postId, reply, image);\n      setReply('');\n      setImage(null);\n    }\n  };\n  var selectImage = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      var permissionResult = yield ImagePicker.requestMediaLibraryPermissionsAsync();\n      if (permissionResult.granted === false) {\n        alert('Permission to access camera roll is required!');\n        return;\n      }\n      var result = yield ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.Images,\n        allowsEditing: true,\n        aspect: [4, 3],\n        quality: 1\n      });\n      if (!result.canceled) {\n        setImage(result.uri);\n      }\n    });\n    return function selectImage() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var handleDeleteImage = function handleDeleteImage() {\n    setImage(null);\n  };\n  return _jsxs(View, {\n    style: styles.bottomnav,\n    children: [image && _jsxs(View, {\n      style: styles.viewimage,\n      children: [_jsx(Image, {\n        source: {\n          uri: image\n        },\n        style: styles.setimage\n      }), _jsx(TouchableOpacity, {\n        onPress: handleDeleteImage,\n        style: styles.deleteButton,\n        children: _jsx(FontAwesome, {\n          name: \"times\",\n          size: 20,\n          color: \"#2696b8\"\n        })\n      })]\n    }), _jsx(TouchableOpacity, {\n      onPress: selectImage,\n      style: styles.attachmentIcon,\n      children: _jsx(FontAwesome, {\n        name: \"image\",\n        size: 20,\n        color: \"rgba(38, 150,184,0.7)\"\n      })\n    }), _jsx(TextInput, {\n      style: styles.topicInput,\n      placeholder: \"Join the conversation\",\n      onChangeText: setReply,\n      value: reply,\n      maxLength: 300\n    }), _jsx(TouchableOpacity, {\n      onPress: handleCommentSubmit,\n      style: styles.attachmentIcon,\n      children: _jsx(FontAwesome, {\n        name: \"send-o\",\n        size: 20,\n        color: \"rgba(38, 150,184,0.7)\"\n      })\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  bottomnav: {\n    position: 'absolute',\n    left: 0,\n    right: 0,\n    bottom: 0,\n    padding: 10,\n    backgroundColor: 'white',\n    flexDirection: 'row',\n    borderTopWidth: 3,\n    borderTopColor: '#f8f8f8'\n  },\n  topicInput: {\n    borderWidth: 1,\n    borderColor: '#f0f0f0',\n    borderRadius: 10,\n    padding: 10,\n    flex: 1\n  },\n  attachmentIcon: {\n    height: 30,\n    width: 35,\n    marginVertical: 10,\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  setimage: {\n    height: 200,\n    borderRadius: 20\n  },\n  viewimage: {\n    height: 200,\n    left: 10,\n    right: 10,\n    bottom: 70,\n    position: 'absolute'\n  },\n  deleteButton: {\n    borderRadius: 100,\n    backgroundColor: 'white',\n    width: 25,\n    height: 25,\n    alignItems: 'center',\n    justifyContent: 'center',\n    position: 'absolute',\n    margin: 10\n  }\n});\nexport default CreateComment;","map":{"version":3,"names":["React","useState","useEffect","View","TextInput","StyleSheet","TouchableOpacity","Image","collection","addDoc","serverTimestamp","db","useSelector","ImagePicker","FontAwesome","getStorage","ref","uploadBytes","getDownloadURL","jsx","_jsx","jsxs","_jsxs","CreateComment","_ref","postId","_useState","_useState2","_slicedToArray","reply","setReply","userId","state","userProfile","_useState3","_useState4","image","setImage","handleCommentSubmit","trim","addComment","_ref2","_asyncToGenerator","comment","commentRef","handleImageUpload","_ref3","setLoading","storage","app","storageRef","Date","now","response","fetch","blob","uploadTask","downloadURL","_x3","apply","arguments","timestamp","error","alert","console","_x","_x2","selectImage","_ref4","permissionResult","requestMediaLibraryPermissionsAsync","granted","result","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","allowsEditing","aspect","quality","canceled","uri","handleDeleteImage","style","styles","bottomnav","children","viewimage","source","setimage","onPress","deleteButton","name","size","color","attachmentIcon","topicInput","placeholder","onChangeText","value","maxLength","create","position","left","right","bottom","padding","backgroundColor","flexDirection","borderTopWidth","borderTopColor","borderWidth","borderColor","borderRadius","flex","height","width","marginVertical","alignItems","justifyContent","margin"],"sources":["/home/leo/Documents/Campus-Vibes-V1/mobile/screens/CreateComment.js"],"sourcesContent":["import { React, useState, useEffect} from \"react\";\nimport { View, TextInput, StyleSheet, TouchableOpacity, Image } from 'react-native';\nimport { collection, addDoc, serverTimestamp} from 'firebase/firestore';\nimport { db } from '../firebase/firebase';\nimport { useSelector } from \"react-redux\";\nimport * as ImagePicker from 'expo-image-picker';\nimport { FontAwesome } from '@expo/vector-icons';\nimport { getStorage, ref, uploadBytes, getDownloadURL} from 'firebase/storage';\n\n\nconst CreateComment = ({postId}) => {\n    const [reply, setReply] = useState('');\n    const userId = useSelector((state) => state.userProfile.userId);\n    const [image, setImage] = useState(null);\n\n    //   Send comments to subcollection\n    const handleCommentSubmit = () => {\n      if (reply.trim() !== '') {\n        const addComment = async (postId, comment) => {\n          try {\n            const commentRef = collection(db, 'Posts', postId, 'comments');\n            const handleImageUpload = async (image) => {\n              setLoading(true);\n              const storage = getStorage(app);\n              const storageRef = ref(storage, `images/${Date.now()}_${image}`);\n              \n              // Fetch image data\n              const response = await fetch(image);\n              const blob = await response.blob();\n              \n              // Upload image data to Firebase Storage\n              const uploadTask = uploadBytes(storageRef, blob);\n              await uploadTask;\n              \n              // Get the download URL for the uploaded image\n              const downloadURL = await getDownloadURL(storageRef);\n              return downloadURL;\n            };\n            \n            let downloadURL = '';\n            if (image){\n            downloadURL = await handleImageUpload(image);\n            }\n            await addDoc(commentRef, {\n              userId,\n              reply,\n              downloadURL,\n              timestamp: serverTimestamp(),\n            }\n            );\n            // alert('Comment added successfully')\n          } catch (error) {\n            alert('Failed to add comment')\n            console.error('Error adding comment: ', error);\n          }\n        };\n        addComment(postId, reply, image);\n        setReply('');\n        setImage(null);\n      }\n    };\n\n    const selectImage = async () => {\n      let permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();\n      if (permissionResult.granted === false) {\n        alert('Permission to access camera roll is required!');\n        return;\n      }\n    \n      let result = await ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.Images,\n        allowsEditing: true,\n        aspect: [4, 3],\n        quality: 1,\n      });\n    \n      if (!result.canceled) {\n        setImage(result.uri);\n      }\n    };\n    const handleDeleteImage = () => {\n        setImage(null);\n      };\n      \n\n  return (\n    <View style={styles.bottomnav}>\n        {image && (\n         <View style={styles.viewimage}>\n             <Image source={{ uri: image }} style={styles.setimage} />\n             <TouchableOpacity onPress={handleDeleteImage} style={styles.deleteButton}>\n                  <FontAwesome name=\"times\" size={20} color=\"#2696b8\" />\n               </TouchableOpacity>\n           </View>\n        )}\n      <TouchableOpacity onPress={selectImage} style={styles.attachmentIcon}>\n         <FontAwesome name=\"image\" size={20} color=\"rgba(38, 150,184,0.7)\" />\n      </TouchableOpacity>\n      <TextInput \n        style={styles.topicInput}\n        placeholder=\"Join the conversation\"\n        onChangeText={setReply}\n        value={reply}\n        maxLength={300}\n      />\n      <TouchableOpacity onPress={handleCommentSubmit}style={styles.attachmentIcon}>\n        <FontAwesome name=\"send-o\" size={20} color=\"rgba(38, 150,184,0.7)\" />\n      </TouchableOpacity>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n    bottomnav:{\n        position: 'absolute', left: 0, right: 0, bottom: 0,\n        padding: 10, backgroundColor: 'white',\n        flexDirection: 'row', borderTopWidth:3, borderTopColor: '#f8f8f8'\n    \n    },\n    topicInput:{\n        borderWidth: 1, borderColor: '#f0f0f0', borderRadius: 10,\n        padding: 10,  flex: 1,\n    },\n    attachmentIcon: {\n        height: 30,\n        width: 35,\n        marginVertical: 10,\n        alignItems: 'center', justifyContent: 'center'\n        \n    },\n    setimage:{\n         height: 200,\n         borderRadius: 20,\n    },\n    viewimage:{\n        height: 200,\n        left: 10, right: 10,bottom: 70, \n       position: 'absolute',\n   },\n   deleteButton:{\n    borderRadius: 100, backgroundColor: 'white',\n     width: 25, height:25,\n    alignItems: 'center', justifyContent: 'center',\n    position:'absolute', margin:10,\n  },\n    \n});\n\nexport default CreateComment;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}